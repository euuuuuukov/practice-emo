# Алгоритм поиска областей электромагнитной обстановки (ЭМО)

Программа предназначена для поиска трехмерных областей пространства, в которых напряженность электрического поля превышает заданный порог. Она применяется при моделировании электромагнитной обстановки вокруг спутника с РСА, чтобы не просчитывать все точки подряд, а детально обследовать только нужные зоны. Алгоритм строит сетку с переменным шагом, находит хотя бы одну точку внутри области, затем уточняет ее границы и заполняет область значениями поля с заданной точностью. Поиск повторяется, пока не будут обнаружены все изолированные области.

## Как работает алгоритм

Работа разбита на несколько этапов.

### 1. Поиск стартовой точки
Сначала задается максимальный шаг сетки (грубый). Программа перебирает все узлы с этим шагом и вызывает функцию расчета. Если находится точка, где выше порога, она запоминается как "затравочная". Если на текущей сетке ничего нет, шаг уменьшается вдвое, и проход повторяется. Так продолжается до тех пор, пока шаг не станет меньше минимально допустимого. Если точка так и не нашлась, считается, что в данной части пространства искомых областей нет.

### 2. Определение границ области
От найденной точки выполняются шесть проходов - в положительном и отрицательном направлениях каждой координатной оси. Каждый проход состоит из двух частей:
- Делаем прыжки с увеличивающимся шагом, пока не окажемся вне области (или за пределами расчетной области). Запоминаем последнюю точку внутри и первую снаружи.
- Между внутренней и внешней точками применяем деление отрезка пополам, пока расстояние между ними не станет меньше заданной точности. Последняя внутренняя точка считается границей по данному направлению.

В результате получаем прямоугольный параллелепипед, который заведомо содержит всю область.

### 3. Детальный расчет внутри области
Внутри найденного параллелепипеда строится равномерная сетка с шагом, заданным пользователем. Для каждого узла вычисляется напряженность и сохраняется в одномерный тензор. Все просчитанные узлы помечаются в глобальном маркере, чтобы при следующем поиске не обрабатывать их повторно.

### 4. Поиск остальных областей
После завершения обработки одной области программа возвращается к этапу 1, но теперь при переборе узлов игнорирует те, что уже помечены. Так продолжается, пока находятся новые затравочные точки. В итоге формируется список всех областей, каждая из которых содержит свои границы и тензор значений напряженности.

## Входные данные (параметры)

Пользователь вводит следующие величины:

- **Глобальные границы** - весь объем, в котором ведется поиск.
- **Пороговое значение напряженности**.
- **Максимальный шаг поиска** - начальный шаг сетки для поиска затравочных точек.
- **Минимальный шаг поиска** - шаг, до которого может дробиться сетка, если грубый проход ничего не дал.
- **Шаг грубого расширения границы** - величина первого прыжка при поиске границы.
- **Точность границы** - минимальное расстояние, до которого уточняется положение границы.
- **Шаг детального расчета** - шаг сетки внутри найденной области (финальный тензор).

## Сборка и запуск

Проект состоит из нескольких файлов:
- `point.h`, `region.h` - описания структур.
- `math_model.h`, `math_model.cpp` - тестовая функция, имитирующая поле.
- `field_searcher.h`, `field_searcher.cpp` - основная логика.
- `main.cpp` - консольный интерфейс.

Для компиляции можно использовать любой компилятор с поддержкой C++17 (я делал в VS Code, поэтому все дальнейшие команды будут для него в `Developer Command Prompt for VS 2022`).

```bash
cl /EHsc /std:c++17 main.cpp field_searcher.cpp math_model.cpp
main.exe
```

После запуска программа последовательно запрашивает все параметры. Их нужно вводить через пробел (для двух чисел) или просто число. Если ввод неверен, программа попросит повторить.

## Пример работы

```
C:\Users\05kov\.vscode\practice-emo>main.exe
Введите параметры поиска областей ЭМО:
Глобальные границы Xmin Xmax: -50 80
Глобальные границы Ymin Ymax: -60 60
Глобальные границы Zmin Zmax: -40 90
Порог E_threshold: 50
Шаги поиска (coarseStep fineStep): 20 2
Шаги границы (borderCoarse borderFine): 10 0.5
Шаг детального расчёта (detailStep): 1

Запуск поиска...

Найдено областей: 2

Область 1:
  X: [-1.875, 21.875]
  Y: [-7.812, 7.812]
  Z: [-4.375, 14.375]
  Сетка: 24 x 16 x 19 = 7296 точек

Область 2:
  X: [-29.062, -10.938]
  Y: [0.938, 19.062]
  Z: [-25.312, -4.531]
  Сетка: 19 x 19 x 21 = 7581 точек
```

## Что можно улучшить

Вместо перебора по осям для поиска границ можно использовать градиентный подъем от затравочной точки, чтобы быстро выйти на максимум, а затем спускаться до порога. Однако для этого придется численно вычислять градиент, что увеличит число обращений к функции, но может ускорить определение формы области. Я могу вручную задать градиент или вычислить его какими-нибудь численными методами - это можно обсудить. Я пока не разобрался в физике явления, поэтому пока не могу утверждать, что локальный максимум один.